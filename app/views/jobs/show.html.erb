
<div class='user-id' data-id="<%= @job.user.id %>"></div>
<div class='job-id' data-id="<%= @job.id %>"></div>


<div id='top'>
	<div id='show-title'></div>
	<div id='job-link'></div>
	<div id='job-date-posted'></div>

	
	<div id='job-applied'></div>
	<div id='applied-btn'></div>




	<td><%= link_to "Edit", edit_user_job_path(@job.user, @job) %></td>
    <td><%= link_to "Delete", user_job_path(@job.user, @job), :method => :delete %></td>

</div>


<div id='mid'>
    
    <div id='docs' class='links-col'>
    	<%= render 'documents/document_dropdown' %>
    	<h3>LINKED DOCUMENTS</h3>
    	<div id='document-list'></div>
    	<%= render partial: "documents/document", collection: @job.documents || "No Linked Documents" %>
    </div>    


    <div id='contacts' class='links-col'>
		 <%= render 'contacts/contact_dropdown' %>
    	<h3>LINKED CONTACTS</h3>
    	<div id='contact-list'></div>
    	<%= render partial: "contacts/contact", collection: @job.contacts || "No Linked Contacts" %>
    </div>    


    <div id='Tasks' class='links-col'>

		<div id='task-list'></div>
    	<h3>TASKS</h3>
    	
    	<%= render partial: "tasks/task", collection: @job.tasks || "No Linked Tasks" %>

    </div>  


</div>




<div class='bottom'>

	<% if !!@job.job_desc%>
		<h3 class='links-col-50'> View Job Description </h3>
		<p><% @job.job_desc %></p>
	<% end %>

	
	<% if !!@job.co_desc %>
		<h3 class='links-col-50'> View Company Description </h3>
		<p><% @job.co_desc %></p>
	<% end %>

</div>







<script>


$( document ).on('turbolinks:load', function() {
	user_id = $(".user-id").data("id")
	job_id = $(".job-id").data("id")

	$.get(`/users/${user_id}/jobs/${job_id}.json`, function(data) {
		job = new Job(data, user_id)

	    displayJobDetails(job)

	    nextButton()
	    previousButton()

		linkContact()
		linkDocument()

		buttonFunc(job)


	});
})






const buttonFunc = function (job) {
	$('#add-applied').on('click', function() {
		console.log(!job.applied)

	    $.get(`/users/${user_id}/jobs/${job_id}/applied?q=${!job.applied}`, function(data) {
	    })
	})
}




const displayJobDetails = function (job) {
	$('#show-title').append(job.jobTitle())
	$('#job-date-posted').append(job.datePosted())
	$('#job-link').append(job.jobLink())
	$('#job-applied').append(job.appliedString())

	$('#applied-btn').append(job.appliedButton())
}









const nextButton = function() {
	$('.btn-next').on('click', function() {
		let nextPg = `${job_id}/next`
		window.location.href = nextPg;
	})
}

const previousButton = function() {
	$('.btn-previous').on('click', function() {		
		let previousPg = `${job_id}/previous`
		window.location.href = previousPg;
	})
}





const linkContact = function() {
	let contactId = $('#job-contact-ids')
	$('#btn-add-contact').on('click', function(e) {
		e.preventDefault()
		var form = $('#add-contact')
		var action = form.attr('action')
		var c_id = form.serialize()

		$.ajax({url: `/users/${user_id}/jobs/${job_id}/add_contact`, 
			data: c_id, 
			type: "PATCH"})
	})
}


const linkDocument = function() {
	let documentId = $('#job-document-ids')
	$('#btn-add-document').on('click', function(e) {
		e.preventDefault()
		var form = $('#add-document')
		var action = form.attr('action')
		var d_id = form.serialize()

		$.ajax({url: `/users/${user_id}/jobs/${job_id}/add_document`,
		data: d_id,
		type: "PATCH"})
	})
}








const appendDocument = function (document) {
	var descriptionText = "<p>" + document['title'] + "</p>"
    $("#document-list").append(descriptionText);
}


const getDocument = function (data) {
    jQuery(data['documents']).each(function(i, document){
        appendDocument(document)
    })
}



user_id = $(".user-id").data("id")
job_id = $(".job-id").data("id")

$('#add-applied').on('click', function() {

    $.get(`/users/${user_id}/jobs/${job_id}/applied?q=${'true'}`, function(data) {

    })
})







var clicks = 0

$(function () {

  $("i.doc").on('click', function() {
    var id = this.id
    console.log('doc')

  	if (clicks % 2 == 0) {
	    $('.document.'+id).css('display', 'block')
    	clicks++
	}
	else {
		$('.document.'+id).css('display', 'none')
		clicks++
	} 
  });

});



var clicks = 0

$(function () {

  $("i.contact").on('click', function() {
    var id = this.id
    console.log('contact')

  	if (clicks % 2 == 0) {
	    $('.contact.'+id).css('display', 'block')
    	clicks++
	}
	else {
		$('.contact.'+id).css('display', 'none')
		clicks++
	} 
  });

});


var clicks = 0

$(function () {

  $("i.task").on('click', function() {
    var id = this.id
    console.log('task')

  	if (clicks % 2 == 0) {
	    $('.task.'+id).css('display', 'block')
    	clicks++
	}
	else {
		$('.task.'+id).css('display', 'none')
		clicks++
	} 
  });

});



</script>











